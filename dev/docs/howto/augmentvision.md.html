<HTML><head><title>How to augment vision data</title><link href=../../template/hugobook.css rel=stylesheet ></link><link href=../../template/ansi.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FastAI.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../setup.md.html title= >Setup</a></p></li><li><p><a href=../quickstart.md.html title= >Quickstart</a></p></li><li><p>Tutorials</p><ul><li><p><a href=../introduction.md.html title= >Introduction</a></p></li><li><p><a href=../data_containers.md.html title= >Data containers</a></p></li><li><p><a href=../learning_methods.md.html title= >Learning methods</a></p></li><li><p><a href=../../notebooks/serialization.ipynb.html title= >Saving and loading models</a></p></li><li><p><a href=../../tutorials/presizing.ipynb.html title= >Presizing vision datasets</a></p></li></ul></li><li><p>Learning tasks</p><ul><li><p><a href=../methods/imageclassification.md.html title= >Image classification</a></p></li><li><p><a href=../../notebooks/imagesegmentation.ipynb.html title= >Image segmentation</a></p></li><li><p><a href=../../notebooks/keypointregression.ipynb.html title= >Keypoint regression</a></p></li></ul></li><li><p>How To</p><ul><li><p><a href=../../notebooks/fitonecycle.ipynb.html title= >Train a model from scratch</a></p></li><li><p><a href=../../notebooks/finetune.ipynb.html title= >Finetune a pretrained model</a></p></li><li><p><a href=../../notebooks/lrfind.ipynb.html title= >Find a good learning rate</a></p></li><li><p><a href=augmentvision.md.html title= >Augment vision data</a></p></li><li><p><a href=../../notebooks/how_to_visualize.ipynb.html title= >Visualize data</a></p></li><li><p><a href=logtensorboard.md.html title= >Log to TensorBoard</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../interfaces.md.html title= >Interfaces</a></p></li><li><p><a href=../api.md.html title= >API</a></p></li><li><p><a href=../glossary.md.html title= >Glossary</a></p></li></ul></li><li><p>Background</p><ul><li><p><a href=../background/datapipelines.md.html title= >Performant data pipelines</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=how-to-augment-vision-data >How to augment vision data</h1><p>Data augmentation is important to train models with good generalization ability, especially when the size of your dataset is limited. FastAI.jl gives you high-level helpers to use data augmentation in vision learning methods, but also allows directly using <a href=https://github.com/lorenzoh/DataAugmentation.jl title= >DataAugmentation.jl</a>, the underlying data augmentation library.</p><p>By default, the only augmentation that will be used in computer vision tasks is a random crop, meaning that after images, keypoints and masks are resized to a similar size a random portion will be cropped during training. We can demonstrate this on the image classification task.</p><div result=false output=false class=cellcontainer cell=main lang=julia ><pre result=false output=false class=codecell cell=main lang=julia ><code>using FastAI
using CairoMakie; CairoMakie.activate!(type=&quot;png&quot;)

dir = joinpath(datasetpath(&quot;dogscats&quot;), &quot;train&quot;)
data = loadtaskdata(dir, ImageClassification)
classes = Datasets.getclassesclassification(dir)
method = ImageClassification(classes, (100, 128))
xs, ys = FastAI.makebatch(method, data, fill(4, 9))
FastAI.plotbatch(method, xs, ys)
</code></pre></div><p>Most learning methods let you pass additional augmentations as keyword arguments. For example, <code>ImageClassification</code> takes the <code>aug_projection</code> and <code>aug_image</code> arguments. FastAI.jl provides the <a href=../../REFERENCE/FastAI.augs_projection.html ><code>augs_projection</code></a> helper to quickly construct a set of projective data augmentations.</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method2 = ImageClassification(classes, (100, 128), aug_projection=augs_projection())
xs2, ys2 = FastAI.makebatch(method2, data, fill(4, 9))
f = FastAI.plotbatch(method2, xs2, ys2)
</code></pre><pre class=coderesult ><code>LoadError("string", 3, MethodError(DataLoaders._batchsize, (Float32[1.4440448 1.4097953 … 1.9577874 2.0262864; 1.4954191 1.4954191 … 2.060536 2.0262864; … ; 1.4097953 1.2042983 … -2.117904 -2.117904; 1.221423 1.3241715 … -2.117904 -2.117904]

Float32[1.6582633 1.6057423 … 2.1484594 2.2184873; 1.7808123 1.6757703 … 2.2535014 2.2184873; … ; 0.9754903 0.57282925 … -2.0357141 -2.0357141; 0.74789923 0.6778712 … -2.0357141 -2.0357141]

Float32[1.8556864 1.5942485 … 2.4308496 2.5005665; 2.0299783 1.8033988 … 2.535425 2.5005665; … ; 0.65307206 0.2870589 … -1.8044444 -1.8044444; 0.40906325 0.40906325 … -1.8044444 -1.8044444]

Float32[1.5296686 1.5296686 … -2.117904 -2.117904; 1.5639181 1.5467933 … -2.117904 -2.117904; … ; -2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[1.6932774 1.6932774 … -2.0357141 -2.0357141; 1.7983193 1.7808123 … -2.0357141 -2.0357141; … ; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[1.8731157 1.8731157 … -1.8044444 -1.8044444; 1.9428324 1.9428324 … -1.8044444 -1.8044444; … ; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444]

Float32[-2.117904 -2.117904 … 1.3584211 1.3755459; -2.117904 -2.117904 … 1.3584211 1.4611696; … ; 1.9406626 1.923538 … 1.4611696 1.2556726; 1.9064132 1.923538 … 1.3584211 1.3412963]

Float32[-2.0357141 -2.0357141 … 1.5532213 1.5707283; -2.0357141 -2.0357141 … 1.5532213 1.6582633; … ; 2.1484594 2.1659663 … 0.2577032 0.2051822; 2.1309524 2.1659663 … -0.00490195 0.15266106]

Float32[-1.8044444 -1.8044444 … 1.6813945 1.6988237; -1.8044444 -1.8044444 … 1.6813945 1.7859696; … ; 2.4482791 2.4308496 … 0.23477131 0.16505454; 2.4134207 2.4308496 … 0.11276696 0.18248373]

Float32[-2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904; … ; 1.8207895 1.8721637 … 1.0673003 1.1529241; 1.8892884 1.8892884 … 1.1357993 1.3241715]

Float32[-2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; … ; 2.1309524 2.1834733 … 0.64285725 0.76540625; 2.1484594 2.1484594 … 0.74789923 1.0805323]

Float32[-1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; … ; 2.3959913 2.4308496 … 0.5484969 0.7576472; 2.4482791 2.4308496 … 0.65307206 1.0539435]

Float32[-2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904; … ; 1.5639181 1.5981677 … 1.8207895 1.8207895; 1.5639181 1.6152923 … 1.8379141 1.8550389]

Float32[-2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; … ; 1.6757703 1.7457983 … 2.0434172 2.0434172; 1.6757703 1.7633053 … 2.0784314 2.0959384]

Float32[-1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; … ; 1.8033988 1.8905448 … 2.343704 2.3785625; 1.8033988 1.907974 … 2.343704 2.3611329]

Float32[-2.117904 -2.117904 … -0.14855729 0.005565486; -2.117904 -2.117904 … -0.23418105 -0.11430778; … ; -2.117904 -2.117904 … 1.2556726 1.221423; -2.117904 -2.117904 … 1.3412963 1.3412963]

Float32[-2.0357141 -2.0357141 … -0.547619 -0.42507; -2.0357141 -2.0357141 … -0.47759098 -0.547619; … ; -2.0357141 -2.0357141 … -0.30252096 -0.17997196; -2.0357141 -2.0357141 … -0.24999997 -0.17997196]

Float32[-1.8044444 -1.8044444 … -0.68897593 -0.49725482; -1.8044444 -1.8044444 … -0.63668835 -0.54954237; … ; -1.8044444 -1.8044444 … -0.20095852 -0.11381256; -1.8044444 -1.8044444 … -0.09638336 -0.061524976]

Float32[1.7351656 1.7180408 … 2.2317834 2.1461596; 1.6837914 1.6666666 … 2.2317834 2.2317834; … ; 0.74193 1.6324171 … 1.4954191 1.4954191; 1.3584211 1.5981677 … 1.4954191 1.4954191]

Float32[1.9033613 1.8858544 … 2.4110641 2.3935575; 1.8683473 1.8683473 … 2.4110641 2.4285715; … ; 0.2226892 1.3781513 … 1.5882353 1.6407562; 1.0105042 1.4481792 … 1.5882353 1.6232493]

Float32[2.0822659 2.0996952 … 2.622571 2.64; 2.0474076 2.0648367 … 2.622571 2.64; … ; 0.46135095 1.5942485 … 1.7511113 1.7685405; 1.193377 1.5942485 … 1.7511113 1.7685405]

Float32[1.3584211 1.42692 … -2.117904 -2.117904; 1.4611696 1.1871736 … -2.117904 -2.117904; … ; 1.2385478 1.3070468 … -2.117904 -2.117904; 1.3755459 1.5639181 … -2.117904 -2.117904]

Float32[-0.28501397 -0.28501397 … -2.0357141 -2.0357141; -0.12745096 -0.44257697 … -2.0357141 -2.0357141; … ; 0.3102242 0.3977592 … -2.0357141 -2.0357141; 0.5203082 0.7303922 … -2.0357141 -2.0357141]

Float32[-0.32296288 -0.23581691 … -1.8044444 -1.8044444; -0.18352933 -0.4623964 … -1.8044444 -1.8044444; … ; 0.3044881 0.2522005 … -1.8044444 -1.8044444; 0.49620935 0.6705013 … -1.8044444 -1.8044444]

Float32[-2.117904 1.42692 … 1.7351656 1.8379141; -2.117904 1.5296686 … 1.6495419 1.7351656; … ; 1.4954191 1.4611696 … 1.5296686 1.5296686; 1.4440448 1.4611696 … 1.5296686 1.5296686]

Float32[-2.0357141 1.6757703 … 1.9383754 2.0259104; -2.0357141 1.7282913 … 1.8508403 1.9208683; … ; 1.8158263 1.7633053 … 1.6232493 1.6232493; 1.7633053 1.7457983 … 1.6232493 1.6232493]

Float32[-1.8044444 1.7859696 … 2.1345534 2.2914162; -1.8044444 1.8556864 … 2.0474076 2.2042704; … ; 2.1171243 2.0299783 … 1.7859696 1.7859696; 2.0648367 2.0125492 … 1.7859696 1.7859696],), 0x0000000000007610))</code></pre></div><p>Likewise, there is an <a href=../../REFERENCE/FastAI.augs_lighting.html ><code>augs_lighting</code></a> helper that adds contrast and brightness augmentation:</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method3 = ImageClassification(
    classes, (100, 128),
    aug_projection=augs_projection(), aug_image=augs_lighting())
xs3, ys3 = FastAI.makebatch(method3, data, fill(4, 9))
FastAI.plotbatch(method3, xs3, ys3)
</code></pre><pre class=coderesult ><code>LoadError("string", 5, MethodError(DataLoaders._batchsize, (Float32[1.6666666 1.8892884 … 2.2489083 2.2489083; 1.7522904 1.4440448 … 2.2489083 2.2489083; … ; 2.0434113 2.0091617 … -1.980906 -1.980906; 1.923538 2.060536 … -1.980906 -1.980906]

Float32[0.5203082 0.8004202 … 2.4285715 2.4285715; 0.78291327 0.4677872 … 2.4285715 2.4285715; … ; 2.0259104 1.6757703 … -1.9306722 -1.9306722; 1.9033613 1.7282913 … -1.9306722 -1.9306722]

Float32[0.37420484 0.6356429 … 2.64 2.64; 0.65307206 0.33934647 … 2.64 2.64; … ; 1.7685405 1.4373858 … -1.7172985 -1.7172985; 1.5768193 1.454815 … -1.7172985 -1.7172985]

Float32[2.0262864 2.0776608 … 1.4440448 1.4097953; 2.0434113 1.9749122 … 1.2727973 1.3755459; … ; 1.5639181 1.4954191 … 1.9406626 1.9406626; 1.4954191 1.42692 … 1.9577874 1.9406626]

Float32[2.2184873 2.2710083 … 1.3781513 1.5532213; 2.235994 2.1659663 … 1.2030813 1.5532213; … ; 1.7983193 1.7282913 … 2.1309524 2.1309524; 1.7282913 1.6582633 … 2.1484594 2.1309524]

Float32[2.4308496 2.4831376 … 1.4896734 1.6813945; 2.4482791 2.3785625 … 1.3153814 1.6639653; … ; 2.1345534 2.0299783 … 2.343704 2.343704; 2.0648367 1.9602616 … 2.3611329 2.343704]

Float32[1.9577874 1.9749122 … -2.117904 -2.117904; 1.9406626 1.9920369 … -2.117904 -2.117904; … ; 1.3926706 1.3412963 … 1.6837914 1.6837914; 1.4611696 1.4954191 … 1.6837914 1.6837914]

Float32[2.1659663 2.1834733 … -2.0357141 -2.0357141; 2.1484594 2.2009804 … -2.0357141 -2.0357141; … ; 1.7808123 1.6407562 … 1.7983193 1.7983193; 1.7107843 1.6757703 … 1.7983193 1.7983193]

Float32[2.3785625 2.4134207 … -1.8044444 -1.8044444; 2.343704 2.4308496 … -1.8044444 -1.8044444; … ; 2.1519828 1.9254032 … 1.9776908 1.9776908; 1.9602616 1.907974 … 1.9776908 1.9776908]

Float32[2.2489083 2.2489083 … 0.93030226 0.878928; 2.1975338 2.2489083 … 0.93030226 0.94742703; … ; 1.7009162 1.7009162 … 1.7180408 1.8892884; 1.5296686 1.4440448 … 1.7865399 1.8207895]

Float32[2.4285715 2.4285715 … 0.047619052 -0.022408951; 2.3060222 2.4285715 … -0.00490195 0.082633056; … ; 1.6757703 1.6057423 … 1.2030813 1.3431373; 1.4481792 1.2731093 … 1.2906163 1.3956583]

Float32[2.64 2.64 … -0.14867094 -0.20095852; 2.465708 2.64 … -0.23581691 -0.14867094; … ; 1.8905448 1.8208281 … 0.94936836 1.2456646; 1.6639653 1.4722441 … 0.98422676 1.2282355]

Float32[1.7351656 1.7180408 … 0.12543888 0.14256364; 1.8036647 1.7180408 … 0.34806067 0.6220567; … ; -2.117904 -2.117904 … 0.17681314 0.79330426; -2.117904 -2.117904 … 0.38231018 0.70768046]

Float32[2.0084033 1.9908963 … -0.32002798 -0.39005598; 2.0784314 1.9908963 … -0.092436954 0.065126054; … ; -2.0357141 -2.0357141 … -0.12745096 0.55532223; -2.0357141 -2.0357141 … 0.15266106 0.50280124]

Float32[2.1345534 2.1171243 … -0.18352933 -0.21838771; 2.2042704 2.1171243 … -0.009237396 0.21734212; … ; -1.8044444 -1.8044444 … -0.009237396 0.7227889; -1.8044444 -1.8044444 … 0.2522005 0.6356429]

Float32[-2.117904 1.4097953 … 1.0330508 1.0844251; -2.117904 1.3412963 … 1.015926 1.0673003; … ; -2.117904 -2.117904 … 0.7761795 0.82755375; -2.117904 -2.117904 … 0.810429 0.810429]

Float32[-2.0357141 1.6057423 … 1.2205883 1.2731093; -2.0357141 1.5357143 … 1.2030813 1.2556022; … ; -2.0357141 -2.0357141 … 0.9929972 1.0630252; -2.0357141 -2.0357141 … 1.0280112 1.0280112]

Float32[-1.8044444 1.8731157 … 1.367669 1.4199566; -1.8044444 1.8208281 … 1.3328106 1.4025275; … ; -1.8044444 -1.8044444 … 1.2630938 1.3153814; -1.8044444 -1.8044444 … 1.2979523 1.2630938]

Float32[-2.117904 -2.117904 … 1.4097953 1.4782944; -2.117904 -2.117904 … 1.3926706 1.4782944; … ; 1.1700488 1.2042983 … 1.3070468 -2.117904; 1.1700488 1.1700488 … -2.117904 -2.117904]

Float32[-2.0357141 -2.0357141 … 1.5707283 1.6407562; -2.0357141 -2.0357141 … 1.5532213 1.6407562; … ; 1.4131653 1.3956583 … 1.5007002 -2.0357141; 1.4131653 1.3606442 … -2.0357141 -2.0357141]

Float32[-1.8044444 -1.8044444 … 1.7162529 1.7859696; -1.8044444 -1.8044444 … 1.6988237 1.7859696; … ; 1.6465361 1.6465361 … 1.6291069 -1.8044444; 1.6465361 1.6116778 … -1.8044444 -1.8044444]

Float32[1.3755459 1.3755459 … 1.2727973 1.3412963; 1.0330508 1.1015497 … 1.2556726 1.3241715; … ; -2.0836544 -2.0836544 … 0.5364329 0.60493195; -2.0836544 -2.0836544 … 0.57068247 0.6563062]

Float32[1.4481792 1.4656863 … 1.3781513 1.4131653; 1.1505603 1.1680672 … 1.3781513 1.4131653; … ; -2.0182073 -2.0182073 … -1.0903361 -1.0203081; -2.0182073 -2.0182073 … -1.0728291 -0.93277305]

Float32[1.5593902 1.5768193 … 1.541961 1.6116778; 1.0016559 1.193377 … 1.5071026 1.5942485; … ; -1.7870152 -1.7870152 … -1.2989979 -1.229281; -1.7870152 -1.7870152 … -1.2118517 -1.1247058]

Float32[1.5125438 1.5467933 … -0.30268008 -0.16568205; 1.5467933 1.4782944 … -0.37117907 0.09118938; … ; 1.7522904 1.7865399 … 1.1015497 1.1186745; 1.7522904 1.7865399 … 0.96455175 1.0673003]

Float32[1.5007002 1.5532213 … -0.740196 -0.757703; 1.5357143 1.5182073 … -0.91526604 -0.53011197; … ; 1.8858544 1.9208683 … 0.3627452 0.17016806; 1.8858544 1.9208683 … 0.29271722 0.15266106]

Float32[1.7162529 1.7162529 … -0.88069713 -0.8981263; 1.733682 1.6988237 … -1.0898474 -0.68897593; … ; 2.1345534 2.1345534 … 0.37420484 0.07790857; 2.1171243 2.1345534 … 0.2522005 0.043050185],), 0x0000000000007610))</code></pre></div><h2 id=augmentation-in-custom-learning-methods >Augmentation in custom learning methods</h2><p>To use projective and image augmentations in custom learning methods for computer vision tasks, see <a href=../../REFERENCE/FastAI.ProjectiveTransforms.html ><code>ProjectiveTransforms</code></a> and <a href=../../REFERENCE/FastAI.ImagePreprocessing.html ><code>ImagePreprocessing</code></a>, two helpers that every vision method in FastAI.jl uses.</p></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#how-to-augment-vision-data >How to augment vision data</a><ul><li><a href=#augmentation-in-custom-learning-methods >Augmentation in custom learning methods</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>