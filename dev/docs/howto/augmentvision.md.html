<HTML><head><title>How to augment vision data</title><link href=../../template/ansi.css rel=stylesheet ></link><link href=../../template/hugobook.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FastAI.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../setup.md.html title= >Setup</a></p></li><li><p><a href=../quickstart.md.html title= >Quickstart</a></p></li><li><p>Tutorials</p><ul><li><p><a href=../introduction.md.html title= >Introduction</a></p></li><li><p><a href=../data_containers.md.html title= >Data containers</a></p></li><li><p><a href=../learning_methods.md.html title= >Learning methods</a></p></li><li><p><a href=../../notebooks/serialization.ipynb.html title= >Saving and loading models</a></p></li><li><p><a href=../../tutorials/presizing.ipynb.html title= >Presizing vision datasets</a></p></li></ul></li><li><p>Learning tasks</p><ul><li><p><a href=../methods/imageclassification.md.html title= >Image classification</a></p></li><li><p><a href=../../notebooks/imagesegmentation.ipynb.html title= >Image segmentation</a></p></li><li><p><a href=../../notebooks/keypointregression.ipynb.html title= >Keypoint regression</a></p></li></ul></li><li><p>How To</p><ul><li><p><a href=../../notebooks/fitonecycle.ipynb.html title= >Train a model from scratch</a></p></li><li><p><a href=../../notebooks/finetune.ipynb.html title= >Finetune a pretrained model</a></p></li><li><p><a href=../../notebooks/lrfind.ipynb.html title= >Find a good learning rate</a></p></li><li><p><a href=augmentvision.md.html title= >Augment vision data</a></p></li><li><p><a href=../../notebooks/how_to_visualize.ipynb.html title= >Visualize data</a></p></li><li><p><a href=logtensorboard.md.html title= >Log to TensorBoard</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../interfaces.md.html title= >Interfaces</a></p></li><li><p><a href=../api.md.html title= >API</a></p></li><li><p><a href=../glossary.md.html title= >Glossary</a></p></li></ul></li><li><p>Background</p><ul><li><p><a href=../background/datapipelines.md.html title= >Performant data pipelines</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=how-to-augment-vision-data >How to augment vision data</h1><p>Data augmentation is important to train models with good generalization ability, especially when the size of your dataset is limited. FastAI.jl gives you high-level helpers to use data augmentation in vision learning methods, but also allows directly using <a href=https://github.com/lorenzoh/DataAugmentation.jl title= >DataAugmentation.jl</a>, the underlying data augmentation library.</p><p>By default, the only augmentation that will be used in computer vision tasks is a random crop, meaning that after images, keypoints and masks are resized to a similar size a random portion will be cropped during training. We can demonstrate this on the image classification task.</p><div result=false output=false class=cellcontainer cell=main lang=julia ><pre result=false output=false class=codecell cell=main lang=julia ><code>using FastAI
using CairoMakie; CairoMakie.activate!(type=&quot;png&quot;)

dir = joinpath(datasetpath(&quot;dogscats&quot;), &quot;train&quot;)
data = loadtaskdata(dir, ImageClassification)
classes = Datasets.getclassesclassification(dir)
method = ImageClassification(classes, (100, 128))
xs, ys = FastAI.makebatch(method, data, fill(4, 9))
FastAI.plotbatch(method, xs, ys)
</code></pre></div><p>Most learning methods let you pass additional augmentations as keyword arguments. For example, <code>ImageClassification</code> takes the <code>aug_projection</code> and <code>aug_image</code> arguments. FastAI.jl provides the <a href=../../REFERENCE/FastAI.augs_projection.html ><code>augs_projection</code></a> helper to quickly construct a set of projective data augmentations.</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method2 = ImageClassification(classes, (100, 128), aug_projection=augs_projection())
xs2, ys2 = FastAI.makebatch(method2, data, fill(4, 9))
f = FastAI.plotbatch(method2, xs2, ys2)
</code></pre><pre class=coderesult ><code>LoadError("string", 3, MethodError(DataLoaders._batchsize, (Float32[1.4097953 1.5981677 … -0.5253019 -0.59380084; 1.5810429 1.7522904 … -0.67942464 -0.49105233; … ; 1.8379141 1.8721637 … 1.3412963 1.3412963; 1.5810429 1.8550389 … 1.3070468 1.5639181]

Float32[1.6407562 1.7983193 … -1.055322 -1.0728291; 1.8158263 1.9558823 … -1.1953781 -0.9502801; … ; 2.1134453 2.1309524 … -0.17997196 -0.19747896; 1.9908963 2.1659663 … -0.057422955 0.11764706]

Float32[1.8905448 1.9602616 … -1.0027015 -1.0027015; 2.0822659 2.1171243 … -1.229281 -0.91555554; … ; 2.3785625 2.3959913 … -0.21838771 -0.23581691; 2.2914162 2.465708 … -0.16610013 0.025620991]

Float32[-2.117904 -2.117904 … 1.7522904 1.7009162; -2.117904 -2.117904 … 1.8550389 1.8550389; … ; -2.117904 -2.117904 … 1.4097953 1.5810429; -2.117904 -2.117904 … 1.4782944 1.4097953]

Float32[-2.0357141 -2.0357141 … 1.9208683 1.8683473; -2.0357141 -2.0357141 … 2.0259104 2.0259104; … ; -2.0357141 -2.0357141 … 1.5707283 1.6932774; -2.0357141 -2.0357141 … 1.4306723 1.4306723]

Float32[-1.8044444 -1.8044444 … 2.0996952 2.0474076; -1.8044444 -1.8044444 … 2.2042704 2.2042704; … ; -1.8044444 -1.8044444 … 1.7511113 1.9254032; -1.8044444 -1.8044444 … 1.6465361 1.6465361]

Float32[-2.117904 1.7009162 … 1.4782944 1.42692; -2.117904 1.8036647 … 1.42692 1.4097953; … ; -2.117904 -2.117904 … 1.9749122 1.9749122; -2.117904 -2.117904 … 1.9749122 1.9749122]

Float32[-2.0357141 1.8683473 … 1.5357143 1.6582633; -2.0357141 1.9733893 … 1.5707283 1.6582633; … ; -2.0357141 -2.0357141 … 2.1484594 2.1484594; -2.0357141 -2.0357141 … 2.1484594 2.1484594]

Float32[-1.8044444 2.0822659 … 1.6639653 1.7685405; -1.8044444 2.186841 … 1.7162529 1.8033988; … ; -1.8044444 -1.8044444 … 2.3611329 2.3611329; -1.8044444 -1.8044444 … 2.3611329 2.3611329]

Float32[1.7865399 1.4611696 … 1.6666666 1.6495419; 1.7180408 1.42692 … 1.7009162 1.7522904; … ; 2.1975338 2.1632845 … 1.42692 1.2727973; 2.1975338 2.129035 … 1.2556726 1.3926706]

Float32[1.9733893 1.6407562 … 1.9033613 1.8858544; 1.8333333 1.5007002 … 1.9383754 1.9908963; … ; 2.4110641 2.3760502 … 0.2577032 0.15266106; 2.4110641 2.3410363 … -0.00490195 0.15266106]

Float32[1.8556864 1.541961 … 2.169412 2.1519828; 1.6291069 1.2805231 … 2.2042704 2.2565577; … ; 2.5877128 2.5528543 … -0.07895417 -0.11381256; 2.5877128 2.5179958 … -0.30553368 -0.061524976]

Float32[1.8721637 1.8550389 … 1.7009162 1.6324171; 1.8892884 1.8721637 … 1.6495419 1.6666666; … ; 1.221423 1.3755459 … 1.6666666 1.6324171; 1.221423 1.2899221 … 1.6666666 1.6152923]

Float32[2.1134453 2.1134453 … 1.6932774 1.7282913; 2.1309524 2.1309524 … 1.6932774 1.7457983; … ; 1.0280112 0.87044823 … 1.8683473 1.7808123; 1.0280112 0.78291327 … 1.8683473 1.7633053]

Float32[2.3785625 2.3785625 … 1.8731157 1.8905448; 2.3959913 2.3959913 … 1.8208281 1.907974; … ; 0.7227889 0.65307206 … 2.0299783 1.9602616; 0.70535964 0.51363856 … 2.0299783 1.9428324]

Float32[-2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904; … ; 2.0091617 1.9920369 … 1.5810429 1.6152923; 1.9406626 1.9406626 … 1.2727973 1.2899221]

Float32[-2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; … ; 2.2535014 2.235994 … 0.50280124 0.69537824; 2.2535014 2.2710083 … 0.3452382 0.57282925]

Float32[-1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; … ; 2.5179958 2.5005665 … 0.51363856 0.7576472; 2.4831376 2.465708 … 0.33934647 0.5484969]

Float32[1.6495419 1.6152923 … 1.6495419 1.6837914; 1.6152923 1.6837914 … 1.6152923 1.7180408; … ; 1.4097953 1.5810429 … 1.5125438 1.5810429; 1.4440448 1.5125438 … 1.5125438 1.6152923]

Float32[1.9908963 1.9383754 … 1.8333333 1.9383754; 1.9908963 1.9383754 … 1.8158263 1.9733893; … ; 1.4831933 1.4656863 … 1.6932774 1.8333333; 1.4831933 1.3956583 … 1.6932774 1.8333333]

Float32[2.1345534 2.0996952 … 1.9602616 2.0474076; 2.2042704 2.186841 … 1.9428324 2.0822659; … ; 1.454815 1.3502399 … 1.8731157 1.9776908; 1.4373858 1.2456646 … 1.8556864 1.9951199]

Float32[1.6152923 1.4954191 … -2.117904 -2.117904; 1.5981677 1.4611696 … -2.117904 -2.117904; … ; -2.117904 -2.117904 … 1.3755459 1.4782944; -2.117904 -2.117904 … 1.2042983 1.1357993]

Float32[1.8333333 1.7282913 … -2.0357141 -2.0357141; 1.6407562 1.6057423 … -2.0357141 -2.0357141; … ; -2.0357141 -2.0357141 … 0.50280124 0.76540625; -2.0357141 -2.0357141 … 0.13515405 0.17016806]

Float32[1.907974 1.6813945 … -1.8044444 -1.8044444; 1.8033988 1.8208281 … -1.8044444 -1.8044444; … ; -1.8044444 -1.8044444 … 0.19991292 0.42649257; -1.8044444 -1.8044444 … 0.07790857 0.008191798]

Float32[1.7180408 1.6495419 … 1.7865399 1.7865399; 1.7009162 1.5981677 … 1.7522904 1.7522904; … ; 1.5467933 1.5467933 … 1.1186745 1.1871736; 1.5639181 1.5125438 … 1.1700488 1.221423]

Float32[1.9208683 1.8683473 … 1.9558823 1.9558823; 1.9033613 1.8158263 … 1.9208683 1.9208683; … ; 1.6407562 1.6232493 … 1.0630252 1.1855743; 1.6582633 1.6582633 … 1.0105042 1.0980393]

Float32[2.0474076 1.9602616 … 2.169412 2.169412; 2.0299783 1.907974 … 2.0996952 2.0996952; … ; 1.8033988 1.7685405 … 1.1410894 1.2630938; 1.8208281 1.7859696 … 0.8970808 1.0365143],), 0x0000000000007600))</code></pre></div><p>Likewise, there is an <a href=../../REFERENCE/FastAI.augs_lighting.html ><code>augs_lighting</code></a> helper that adds contrast and brightness augmentation:</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method3 = ImageClassification(
    classes, (100, 128),
    aug_projection=augs_projection(), aug_image=augs_lighting())
xs3, ys3 = FastAI.makebatch(method3, data, fill(4, 9))
FastAI.plotbatch(method3, xs3, ys3)
</code></pre><pre class=coderesult ><code>LoadError("string", 5, MethodError(DataLoaders._batchsize, (Float32[-2.117904 1.0330508 … -2.117904 -2.117904; 1.0501755 1.1015497 … -2.117904 -2.117904; … ; -2.117904 -2.117904 … 0.673431 0.72480524; -2.117904 -2.117904 … 0.74193 0.74193]

Float32[-2.0357141 1.2906163 … -2.0357141 -2.0357141; 1.3081232 1.3606442 … -2.0357141 -2.0357141; … ; -2.0357141 -2.0357141 … 0.94047624 1.0280112; -2.0357141 -2.0357141 … 0.9929972 1.0105042]

Float32[-1.8044444 1.5768193 … -1.8044444 -1.8044444; 1.5942485 1.6465361 … -1.8044444 -1.8044444; … ; -1.8044444 -1.8044444 … 1.2108063 1.2979523; -1.8044444 -1.8044444 … 1.2805231 1.2979523]

Float32[1.1871736 1.1015497 … -1.7069099 -1.7069099; 1.1015497 1.0330508 … -1.7069099 -1.7069099; … ; 1.8036647 1.8207895 … 1.7351656 -1.7069099; 1.7694151 1.8036647 … 1.7865399 -1.7069099]

Float32[0.45028022 0.15266106 … -1.7030813 -1.7030813; 0.4327732 0.13515405 … -1.7030813 -1.7030813; … ; 1.8858544 1.9033613 … 1.9033613 -1.7030813; 1.8858544 1.9208683 … 1.9033613 -1.7030813]

Float32[0.39163405 0.16505454 … -1.5081482 -1.5081482; 0.3044881 0.13019615 … -1.5081482 -1.5081482; … ; 2.0648367 2.0822659 … 2.0474076 -1.5081482; 2.0125492 2.0474076 … 2.0648367 -1.5081482]

Float32[0.93030226 0.9131775 … 0.50218344 0.2966864; 0.93030226 0.9131775 … 0.5878072 0.46793392; … ; 0.34806067 0.57068247 … 0.5193082 0.6220567; 0.45080918 0.39943492 … 0.5193082 0.6220567]

Float32[1.1855743 1.1680672 … 0.6603642 0.4677872; 1.1855743 1.1680672 … 0.74789923 0.64285725; … ; 0.030112052 0.047619052 … 0.74789923 0.8529412; 0.065126054 -0.28501397 … 0.74789923 0.8529412]

Float32[1.4722441 1.454815 … 0.7227889 0.44392177; 1.4722441 1.454815 … 0.8099348 0.6007845; … ; -0.13124175 -0.20095852 … 0.9667976 1.0713727; 0.008191798 -0.32296288 … 0.9667976 1.0713727]

Float32[1.2385478 1.1871736 … 1.2899221 1.221423; 1.1357993 1.015926 … 1.3584211 1.3070468; … ; 0.9131775 0.93030226 … 1.2727973 1.3070468; 0.9131775 0.93030226 … 1.2556726 1.2899221]

Float32[1.4656863 1.4306723 … 1.5357143 1.5007002; 1.3606442 1.2380953 … 1.6407562 1.5882353; … ; 1.1855743 1.1680672 … 1.5882353 1.6232493; 1.1855743 1.1680672 … 1.5532213 1.6057423]

Float32[1.6465361 1.6116778 … 1.7859696 1.6988237; 1.541961 1.4199566 … 1.8382572 1.7511113; … ; 1.3850982 1.3850982 … 1.8905448 1.9254032; 1.3850982 1.3850982 … 1.8731157 1.907974]

Float32[0.3651854 0.2966864 … 0.7761795 0.810429; 0.43368444 0.39943492 … 0.810429 0.86180323; … ; 0.39943492 0.39943492 … 0.34806067 0.2624369; 0.39943492 0.38231018 … 0.03981499 0.31381115]

Float32[0.6603642 0.62535024 … 1.0105042 1.0455183; 0.5378152 0.5378152 … 1.0455183 1.0980393; … ; 0.64285725 0.64285725 … 0.5203082 0.48529422; 0.64285725 0.62535024 … 0.13515405 0.50280124]

Float32[0.74021804 0.70535964 … 1.2108063 1.2456646; 0.5833553 0.6007845 … 1.2456646 1.2979523; … ; 0.7925056 0.7925056 … 0.7576472 0.7227889; 0.7925056 0.77507645 … 0.46135095 0.74021804]

Float32[1.4097953 1.2727973 … -2.117904 -2.117904; 0.96455175 0.74193 … -2.117904 -2.117904; … ; 1.5639181 1.4611696 … 1.7351656 1.7351656; 1.5125438 1.4611696 … 1.7351656 1.7009162]

Float32[1.1330533 1.0105042 … -2.0357141 -2.0357141; 0.3627452 0.2051822 … -2.0357141 -2.0357141; … ; 1.6057423 1.3956583 … 1.9558823 1.9558823; 1.6057423 1.3606442 … 1.9733893 1.9383754]

Float32[1.1585187 1.0190852 … -1.8044444 -1.8044444; 0.2522005 0.043050185 … -1.8044444 -1.8044444; … ; 1.4722441 1.0539435 … 2.2914162 2.2914162; 1.3328106 0.98422676 … 2.3088455 2.2739873]

Float32[1.8379141 1.9064132 … 2.11191 2.060536; 1.8721637 1.8892884 … 2.11191 2.11191; … ; 2.11191 2.11191 … 1.5810429 1.5981677; 2.11191 2.11191 … 1.7009162 1.8379141]

Float32[2.0784314 2.1309524 … 2.3235295 2.3235295; 2.0959384 2.1134453 … 2.3235295 2.3235295; … ; 2.3235295 2.3235295 … -0.23249297 -0.23249297; 2.3235295 2.3235295 … -0.19747896 -0.092436954]

Float32[2.186841 2.2565577 … 2.5528543 2.5528543; 2.2042704 2.2391288 … 2.5528543 2.5528543; … ; 2.5528543 2.5528543 … -0.5844008 -0.5844008; 2.5528543 2.5528543 … -0.49725482 -0.4623964]

Float32[1.3412963 1.3070468 … 2.0947855 2.0947855; 1.3412963 1.3926706 … 2.11191 2.11191; … ; 1.6495419 1.5810429 … 1.3412963 1.3926706; 1.6324171 1.5639181 … 1.3241715 1.3412963]

Float32[1.4481792 1.4131653 … 2.2009804 2.2009804; 1.4831933 1.5007002 … 2.2184873 2.2184873; … ; 1.7633053 1.7107843 … 1.4131653 1.5007002; 1.7633053 1.6932774 … 1.3781513 1.4306723]

Float32[1.5593902 1.5245317 … 2.3785625 2.3785625; 1.454815 1.541961 … 2.3959913 2.3959913; … ; 1.907974 1.8556864 … 1.6465361 1.6813945; 1.8905448 1.8208281 … 1.6291069 1.6465361]

Float32[0.82755375 0.9816765 … 1.7009162 1.6666666; 1.0844251 0.8960528 … 1.7522904 1.7180408; … ; 1.8721637 1.923538 … 1.2042983 1.0844251; 1.8550389 1.8892884 … 1.0844251 1.015926]

Float32[-0.07492995 0.0126050515 … 1.9383754 1.9033613; 0.2226892 -0.039915953 … 1.9908963 1.9383754; … ; 2.0084033 1.9558823 … 0.29271722 0.3977592; 2.0434172 2.0434172 … 0.11764706 0.18767506]

Float32[-0.14867094 -0.02666659 … 2.1345534 2.0996952; 0.13019615 -0.09638336 … 2.2391288 2.186841; … ; 2.0648367 2.169412 … 0.23477131 0.2522005; 2.0996952 2.2216995 … 0.07790857 0.11276696],), 0x0000000000007600))</code></pre></div><h2 id=augmentation-in-custom-learning-methods >Augmentation in custom learning methods</h2><p>To use projective and image augmentations in custom learning methods for computer vision tasks, see <a href=../../REFERENCE/FastAI.ProjectiveTransforms.html ><code>ProjectiveTransforms</code></a> and <a href=../../REFERENCE/FastAI.ImagePreprocessing.html ><code>ImagePreprocessing</code></a>, two helpers that every vision method in FastAI.jl uses.</p></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#how-to-augment-vision-data >How to augment vision data</a><ul><li><a href=#augmentation-in-custom-learning-methods >Augmentation in custom learning methods</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>