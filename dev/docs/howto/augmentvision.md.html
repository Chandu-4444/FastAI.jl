<HTML><head><title>How to augment vision data</title><link href=../../template/hugobook.css rel=stylesheet ></link><link href=../../template/ansi.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FastAI.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../setup.md.html title= >Setup</a></p></li><li><p><a href=../quickstart.md.html title= >Quickstart</a></p></li><li><p>Tutorials</p><ul><li><p><a href=../introduction.md.html title= >Introduction</a></p></li><li><p><a href=../data_containers.md.html title= >Data containers</a></p></li><li><p><a href=../learning_methods.md.html title= >Learning methods</a></p></li><li><p><a href=../../notebooks/serialization.ipynb.html title= >Saving and loading models</a></p></li><li><p><a href=../../tutorials/presizing.ipynb.html title= >Presizing vision datasets</a></p></li></ul></li><li><p>Learning tasks</p><ul><li><p><a href=../methods/imageclassification.md.html title= >Image classification</a></p></li><li><p><a href=../../notebooks/imagesegmentation.ipynb.html title= >Image segmentation</a></p></li><li><p><a href=../../notebooks/keypointregression.ipynb.html title= >Keypoint regression</a></p></li></ul></li><li><p>How To</p><ul><li><p><a href=../../notebooks/fitonecycle.ipynb.html title= >Train a model from scratch</a></p></li><li><p><a href=../../notebooks/finetune.ipynb.html title= >Finetune a pretrained model</a></p></li><li><p><a href=../../notebooks/lrfind.ipynb.html title= >Find a good learning rate</a></p></li><li><p><a href=augmentvision.md.html title= >Augment vision data</a></p></li><li><p><a href=../../notebooks/how_to_visualize.ipynb.html title= >Visualize data</a></p></li><li><p><a href=logtensorboard.md.html title= >Log to TensorBoard</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../interfaces.md.html title= >Interfaces</a></p></li><li><p><a href=../api.md.html title= >API</a></p></li><li><p><a href=../glossary.md.html title= >Glossary</a></p></li></ul></li><li><p>Background</p><ul><li><p><a href=../background/datapipelines.md.html title= >Performant data pipelines</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=how-to-augment-vision-data >How to augment vision data</h1><p>Data augmentation is important to train models with good generalization ability, especially when the size of your dataset is limited. FastAI.jl gives you high-level helpers to use data augmentation in vision learning methods, but also allows directly using <a href=https://github.com/lorenzoh/DataAugmentation.jl title= >DataAugmentation.jl</a>, the underlying data augmentation library.</p><p>By default, the only augmentation that will be used in computer vision tasks is a random crop, meaning that after images, keypoints and masks are resized to a similar size a random portion will be cropped during training. We can demonstrate this on the image classification task.</p><div result=false output=false class=cellcontainer cell=main lang=julia ><pre result=false output=false class=codecell cell=main lang=julia ><code>using FastAI
using CairoMakie; CairoMakie.activate!(type=&quot;png&quot;)

dir = joinpath(datasetpath(&quot;dogscats&quot;), &quot;train&quot;)
data = loadtaskdata(dir, ImageClassification)
classes = Datasets.getclassesclassification(dir)
method = ImageClassification(classes, (100, 128))
xs, ys = FastAI.makebatch(method, data, fill(4, 9))
FastAI.plotbatch(method, xs, ys)
</code></pre></div><p>Most learning methods let you pass additional augmentations as keyword arguments. For example, <code>ImageClassification</code> takes the <code>aug_projection</code> and <code>aug_image</code> arguments. FastAI.jl provides the <a href=../../REFERENCE/FastAI.augs_projection.html ><code>augs_projection</code></a> helper to quickly construct a set of projective data augmentations.</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method2 = ImageClassification(classes, (100, 128), aug_projection=augs_projection())
xs2, ys2 = FastAI.makebatch(method2, data, fill(4, 9))
f = FastAI.plotbatch(method2, xs2, ys2)
</code></pre><pre class=coderesult ><code>LoadError("string", 3, MethodError(DataLoaders._batchsize, (Float32[-2.117904 -2.117904 … 1.3584211 1.4611696; -2.117904 -2.117904 … 1.4097953 1.5639181; … ; -2.117904 -2.117904 … 1.5810429 1.5639181; -2.117904 -2.117904 … 1.5981677 1.5639181]

Float32[-2.0357141 -2.0357141 … 0.2577032 0.3802522; -2.0357141 -2.0357141 … 0.2401962 0.4677872; … ; -2.0357141 -2.0357141 … 1.6057423 1.5882353; -2.0357141 -2.0357141 … 1.6232493 1.5882353]

Float32[-1.8044444 -1.8044444 … 0.16505454 0.37420484; -1.8044444 -1.8044444 … 0.14762534 0.46135095; … ; -1.8044444 -1.8044444 … 1.7859696 1.7511113; -1.8044444 -1.8044444 … 1.8033988 1.7685405]

Float32[1.4097953 1.4611696 … 1.5810429 1.5810429; 1.3926706 1.3755459 … 1.5810429 1.5810429; … ; 1.2899221 1.3241715 … 1.6666666 1.6152923; 1.221423 1.4440448 … 1.7180408 1.6837914]

Float32[1.5357143 1.5882353 … 1.6757703 1.6757703; 1.6057423 1.5707283 … 1.6757703 1.6757703; … ; 0.7303922 0.45028022 … 1.9033613 1.8508403; 0.62535024 0.6078432 … 1.9558823 1.9033613]

Float32[1.6639653 1.7162529 … 1.8382572 1.8382572; 1.6988237 1.6988237 … 1.8382572 1.8382572; … ; 0.49620935 0.2696297 … 1.8382572 1.8208281; 0.37420484 0.35677567 … 1.9602616 1.9602616]

Float32[-0.14855729 -0.31980482 … -2.117904 -2.117904; -0.23418105 0.2281874 … -2.117904 -2.117904; … ; 1.4097953 1.2727973 … 1.4782944 1.5467933; 1.2727973 1.221423 … 1.5125438 1.5467933]

Float32[-0.512605 -0.635154 … -2.0357141 -2.0357141; -0.512605 -0.039915953 … -2.0357141 -2.0357141; … ; 0.64285725 0.41526622 … 1.6407562 1.6757703; 0.4677872 0.29271722 … 1.6757703 1.6757703]

Float32[-0.5321132 -0.63668835 … -1.8044444 -1.8044444; -0.5321132 -0.009237396 … -1.8044444 -1.8044444; … ; 0.2870589 -0.061524976 … 1.8208281 1.8033988; 0.2522005 -0.07895417 … 1.8556864 1.8208281]

Float32[1.923538 1.8379141 … -2.117904 -2.117904; 1.8721637 1.7180408 … -2.117904 -2.117904; … ; 1.4782944 1.4440448 … -2.117904 -2.117904; 1.4782944 1.5296686 … -2.117904 -2.117904]

Float32[2.1134453 2.0259104 … -2.0357141 -2.0357141; 2.0609243 1.9208683 … -2.0357141 -2.0357141; … ; 1.5882353 1.3431373 … -2.0357141 -2.0357141; 1.5007002 1.2906163 … -2.0357141 -2.0357141]

Float32[2.3611329 2.2739873 … -1.8044444 -1.8044444; 2.3088455 2.1345534 … -1.8044444 -1.8044444; … ; 1.4896734 1.2108063 … -1.8044444 -1.8044444; 1.3502399 1.0888019 … -1.8044444 -1.8044444]

Float32[1.3412963 1.3241715 … 1.1357993 1.4440448; 1.42692 1.4611696 … 1.2727973 1.4611696; … ; 1.0501755 0.74193 … 1.7694151 1.8550389; 0.93030226 0.4850587 … 1.6324171 1.7180408]

Float32[1.2556022 1.1855743 … 0.71288526 1.1330533; 1.4306723 1.4306723 … 1.0630252 1.3781513; … ; -0.47759098 -0.60014 … 2.0084033 2.0959384; -0.582633 -0.84523803 … 1.9208683 2.0084033]

Float32[1.3502399 1.2630938 … 0.6007845 1.0713727; 1.5942485 1.5942485 … 1.0016559 1.3153814; … ; -0.2706753 -0.34039208 … 2.2739873 2.3611329; -0.34039208 -0.5669716 … 2.169412 2.2565577]

Float32[1.8036647 1.8379141 … 1.5810429 1.5981677; 1.8379141 1.8379141 … 1.5810429 1.5981677; … ; 0.7590547 1.6666666 … 1.3926706 1.4440448; 1.1015497 1.5810429 … 1.3755459 1.42692]

Float32[2.1134453 2.1484594 … 1.6757703 1.6932774; 2.1834733 2.1834733 … 1.6757703 1.6932774; … ; 0.3277312 1.5357143 … 1.5882353 1.6407562; 0.71288526 1.5357143 … 1.5707283 1.6232493]

Float32[2.3785625 2.4134207 … 1.8556864 1.8556864; 2.4134207 2.4134207 … 1.8382572 1.8556864; … ; 0.46135095 1.8382572 … 1.7511113 1.8033988; 0.8970808 1.7859696 … 1.7511113 1.7859696]

Float32[-2.117904 -2.117904 … 1.7351656 -2.117904; -2.117904 -2.117904 … 1.6837914 -2.117904; … ; 1.2385478 1.2556726 … 1.5296686 1.5467933; 1.5467933 1.3926706 … 1.42692 1.42692]

Float32[-2.0357141 -2.0357141 … 1.9208683 -2.0357141; -2.0357141 -2.0357141 … 1.8683473 -2.0357141; … ; 0.29271722 0.2226892 … 1.7107843 1.7282913; 0.76540625 0.48529422 … 1.5707283 1.5707283]

Float32[-1.8044444 -1.8044444 … 2.0474076 -1.8044444; -1.8044444 -1.8044444 … 1.9951199 -1.8044444; … ; 0.51363856 0.42649257 … 1.8556864 1.8556864; 0.8099348 0.5484969 … 1.7162529 1.7162529]

Float32[0.27956167 0.8960528 … -2.117904 -2.117904; 0.60493195 0.74193 … -2.117904 -2.117904; … ; 1.3241715 1.3584211 … 1.5296686 1.5125438; 1.3070468 1.2385478 … 1.5296686 1.5125438]

Float32[-0.28501397 0.3452382 … -2.0357141 -2.0357141; -0.00490195 0.15266106 … -2.0357141 -2.0357141; … ; 0.64285725 0.3627452 … 1.6232493 1.6057423; 0.6078432 0.2577032 … 1.6232493 1.6057423]

Float32[-0.061524976 0.51363856 … -1.8044444 -1.8044444; 0.19991292 0.2522005 … -1.8044444 -1.8044444; … ; 0.3044881 -0.061524976 … 1.7859696 1.7685405; 0.19991292 -0.21838771 … 1.7859696 1.7685405]

Float32[1.3926706 1.3241715 … 0.9988013 1.0330508; 1.3070468 1.3241715 … 0.9816765 1.1700488; … ; -2.117904 -2.117904 … 2.1461596 2.129035; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[1.6407562 1.5707283 … 0.10014006 -0.039915953; 1.5532213 1.6057423 … 0.030112052 0.065126054; … ; -2.0357141 -2.0357141 … 2.2885156 2.2885156; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[1.907974 1.7685405 … 0.07790857 0.060479376; 1.8033988 1.8033988 … -0.11381256 0.025620991; … ; -1.8044444 -1.8044444 … 2.4831376 2.465708; -1.8044444 -1.8044444 … -1.8044444 -1.8044444],), 0x00000000000075fd))</code></pre></div><p>Likewise, there is an <a href=../../REFERENCE/FastAI.augs_lighting.html ><code>augs_lighting</code></a> helper that adds contrast and brightness augmentation:</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method3 = ImageClassification(
    classes, (100, 128),
    aug_projection=augs_projection(), aug_image=augs_lighting())
xs3, ys3 = FastAI.makebatch(method3, data, fill(4, 9))
FastAI.plotbatch(method3, xs3, ys3)
</code></pre><pre class=coderesult ><code>LoadError("string", 5, MethodError(DataLoaders._batchsize, (Float32[1.7180408 1.7694151 … 1.4782944 1.6495419; 1.7694151 1.8207895 … 1.3070468 1.015926; … ; 1.6666666 1.6495419 … 1.7009162 1.5125438; 1.7009162 1.6495419 … 1.6837914 1.5125438]

Float32[2.0084033 2.0784314 … 1.5532213 1.6407562; 2.0784314 2.0784314 … 1.2205883 0.83543426; … ; 1.9908963 1.9733893 … 1.9908963 1.7983193; 2.0259104 1.9733893 … 1.9908963 1.7983193]

Float32[2.2391288 2.3262744 … 1.5593902 1.6116778; 2.3088455 2.3262744 … 1.1585187 0.70535964; … ; 2.3088455 2.2739873 … 1.9951199 1.8382572; 2.3262744 2.2739873 … 1.9428324 1.8033988]

Float32[1.7865399 1.7351656 … 2.0947855 2.0947855; 1.7865399 1.7694151 … 2.1804092 2.1632845; … ; 1.9064132 1.9064132 … 1.7865399 1.6152923; 1.9064132 1.9064132 … 1.7522904 1.7009162]

Float32[1.7457983 1.6757703 … 2.2184873 2.2009804; 1.7633053 1.7107843 … 2.2885156 2.2710083; … ; 1.9033613 1.9033613 … 0.6778712 0.45028022; 1.9033613 1.8858544 … 0.64285725 0.57282925]

Float32[1.7685405 1.6465361 … 2.4134207 2.3959913; 1.7859696 1.6813945 … 2.5005665 2.4831376; … ; 2.0125492 2.0125492 … 0.2870589 0.21734212; 2.0125492 1.9951199 … 0.2522005 0.37420484]

Float32[1.7009162 1.7009162 … 1.4782944 1.6152923; 1.7180408 1.7180408 … 1.4954191 1.5810429; … ; 1.4954191 1.1529241 … 1.4954191 1.4097953; 1.3584211 1.5125438 … 1.4782944 1.4097953]

Float32[2.0434172 2.0434172 … 1.6582633 1.8158263; 2.0609243 2.0609243 … 1.6757703 1.7808123; … ; 1.4831933 0.87044823 … 1.6582633 1.5532213; 1.2906163 1.0805323 … 1.6407562 1.5532213]

Float32[2.2739873 2.2739873 … 1.7859696 1.9428324; 2.2914162 2.2914162 … 1.8033988 1.907974; … ; 1.5593902 0.65307206 … 1.8731157 1.733682; 1.2456646 0.8447932 … 1.8556864 1.733682]

Float32[-1.8952821 -1.8952821 … 0.15968838 0.41655967; -1.8952821 -1.8952821 … 0.2966864 0.14256364; … ; -1.8952821 -1.8952821 … 1.0673003 1.1871736; -1.8952821 -1.8952821 … 0.86180323 1.015926]

Float32[-1.8431373 -1.8431373 … -0.60014 -0.37254897; -1.8431373 -1.8431373 … -0.53011197 -0.65266097; … ; -1.8431373 -1.8431373 … -0.722689 -0.670168; -1.8431373 -1.8431373 … -0.862745 -0.827731]

Float32[-1.6301525 -1.6301525 … -0.7238344 -0.5321132; -1.6301525 -1.6301525 … -0.63668835 -0.8109804; … ; -1.6301525 -1.6301525 … -0.74126357 -0.7064052; -1.6301525 -1.6301525 … -0.9329847 -0.88069713]

Float32[0.94742703 0.9131775 … 1.015926 1.1871736; 0.94742703 0.9131775 … 1.0844251 1.1186745; … ; -2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[1.1680672 1.1330533 … 1.4131653 1.5357143; 1.1680672 1.1330533 … 1.4481792 1.4656863; … ; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[1.3502399 1.3153814 … 1.733682 1.8556864; 1.3502399 1.3153814 … 1.7685405 1.7859696; … ; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444]

Float32[-2.117904 -2.117904 … 2.2489083 2.2489083; -2.117904 -2.117904 … 2.2489083 2.2489083; … ; 2.0434113 2.060536 … 1.8379141 1.8892884; 2.0434113 2.0776608 … 1.9577874 1.9064132]

Float32[-2.0357141 -2.0357141 … 2.4285715 2.4285715; -2.0357141 -2.0357141 … 2.4285715 2.4285715; … ; 2.2535014 2.2710083 … 1.3956583 1.6407562; 2.2535014 2.2885156 … 1.3956583 1.4831933]

Float32[-1.8044444 -1.8044444 … 2.64 2.64; -1.8044444 -1.8044444 … 2.64 2.64; … ; 2.4482791 2.465708 … 1.193377 1.454815; 2.3959913 2.4482791 … 1.2979523 1.367669]

Float32[1.6837914 1.7009162 … 1.0844251 1.4097953; 1.7180408 1.7865399 … 1.4782944 1.4611696; … ; 1.0501755 1.1357993 … 1.5810429 1.6495419; -2.117904 -2.117904 … 1.5981677 1.6495419]

Float32[1.8683473 1.8858544 … 0.2401962 0.7303922; 1.9558823 2.0259104 … 1.0280112 1.1155462; … ; -0.705182 -0.635154 … 1.7808123 1.8508403; -2.0357141 -2.0357141 … 1.7983193 1.8508403]

Float32[2.0822659 2.1171243 … 0.44392177 0.827364; 2.2042704 2.2914162 … 1.1759479 1.3502399; … ; -0.9852723 -0.9678431 … 1.9776908 2.0474076; -1.8044444 -1.8044444 … 1.9951199 2.0474076]

Float32[0.82755375 0.810429 … 1.2556726 1.2556726; 0.8446785 0.878928 … 1.3070468 1.3070468; … ; 0.9131775 0.93030226 … 0.09118938 0.1939379; 0.82755375 0.9816765 … 0.12543888 0.17681314]

Float32[0.87044823 0.87044823 … 1.4831933 1.4831933; 0.90546227 0.94047624 … 1.5182073 1.5357143; … ; 0.6078432 0.62535024 … -0.44257697 -0.17997196; 0.57282925 0.74789923 … -0.35504198 -0.26750696]

Float32[0.94936836 0.91451 … 1.6813945 1.7162529; 0.9667976 0.98422676 … 1.7162529 1.7511113; … ; 0.49620935 0.5484969 … -0.2706753 -0.11381256; 0.40906325 0.56592613 … -0.37525046 -0.30553368]

Float32[0.94742703 0.9131775 … -2.117904 -2.117904; 0.9816765 0.96455175 … -2.117904 -2.117904; … ; -2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[1.1680672 1.1330533 … -2.0357141 -2.0357141; 1.2205883 1.1680672 … -2.0357141 -2.0357141; … ; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[1.2805231 1.2805231 … -1.8044444 -1.8044444; 1.3328106 1.3153814 … -1.8044444 -1.8044444; … ; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444],), 0x00000000000075fd))</code></pre></div><h2 id=augmentation-in-custom-learning-methods >Augmentation in custom learning methods</h2><p>To use projective and image augmentations in custom learning methods for computer vision tasks, see <a href=../../REFERENCE/FastAI.ProjectiveTransforms.html ><code>ProjectiveTransforms</code></a> and <a href=../../REFERENCE/FastAI.ImagePreprocessing.html ><code>ImagePreprocessing</code></a>, two helpers that every vision method in FastAI.jl uses.</p></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#how-to-augment-vision-data >How to augment vision data</a><ul><li><a href=#augmentation-in-custom-learning-methods >Augmentation in custom learning methods</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>